version: '3.8'

services:
    medcalcehr:
        build:
            context: .
            dockerfile: Dockerfile
        image: medcalcehr:latest
        container_name: medcalcehr-app
        ports:
            - '8080:80'
        restart: unless-stopped
        environment:
            - TZ=Asia/Taipei
            - FHIR_CLIENT_ID=${FHIR_CLIENT_ID:-e1b41914-e2b5-4475-90ba-29022b57f820}
            - FHIR_SCOPE=${FHIR_SCOPE:-openid fhirUser launch profile user/Patient.rs user/Observation.rs user/Condition.rs user/MedicationRequest.rs offline_access}
            - FHIR_REDIRECT_URI=${FHIR_REDIRECT_URI:-./index.html}
            - SESSION_TIMEOUT_MINUTES=${SESSION_TIMEOUT_MINUTES:-15}
            - SESSION_WARNING_MINUTES=${SESSION_WARNING_MINUTES:-2}
            - SENTRY_DSN=${SENTRY_DSN:-}
            - SENTRY_ENVIRONMENT=${SENTRY_ENVIRONMENT:-production}
        healthcheck:
            test: ['CMD', 'wget', '--quiet', '--tries=1', '--spider', 'http://localhost/']
            interval: 30s
            timeout: 10s
            retries: 3
            start_period: 40s
        networks:
            - medcalc-network
        labels:
            - 'com.medcalcehr.description=Medical Calculator EHR Integration System'
            - 'com.medcalcehr.version=1.0.0'

networks:
    medcalc-network:
        driver: bridge
