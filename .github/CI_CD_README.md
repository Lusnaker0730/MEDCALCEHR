# CI/CD å·¥ä½œæµèªªæ˜Ž

æœ¬å°ˆæ¡ˆä½¿ç”¨ GitHub Actions é€²è¡ŒæŒçºŒæ•´åˆå’ŒæŒçºŒéƒ¨ç½²ã€‚

## ðŸ“ å·¥ä½œæµæª”æ¡ˆ

```
.github/
â”œâ”€â”€ workflows/
â”‚   â”œâ”€â”€ ci.yml           # ä¸»è¦ CI/CD Pipeline
â”‚   â”œâ”€â”€ pr-check.yml     # PR å¿«é€Ÿæª¢æŸ¥
â”‚   â”œâ”€â”€ release.yml      # ç‰ˆæœ¬ç™¼å¸ƒè‡ªå‹•åŒ–
â”‚   â””â”€â”€ maintenance.yml  # å®šæœŸç¶­è­·
â”œâ”€â”€ dependabot.yml       # ä¾è³´è‡ªå‹•æ›´æ–°
â”œâ”€â”€ labeler.yml          # PR è‡ªå‹•æ¨™ç±¤
â”œâ”€â”€ ISSUE_TEMPLATE/      # Issue æ¨¡æ¿
â”‚   â”œâ”€â”€ bug_report.md
â”‚   â”œâ”€â”€ feature_request.md
â”‚   â””â”€â”€ calculator_issue.md
â””â”€â”€ PULL_REQUEST_TEMPLATE.md
```

---

## ðŸ”„ Pipeline æµç¨‹

### ci.yml - ä¸»è¦ Pipeline

```
Push to main/develop
         â”‚
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Lint   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                          â”‚
         â”‚                               â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”                          â”‚
    â”‚TypeCheckâ”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                      â”‚   â”‚
         â”‚                           â”‚   â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
    â”‚  Test   â”‚    â”‚  Security  â”‚    â”‚   â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
         â”‚               â”‚           â”‚   â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”          â”‚           â”‚   â”‚
    â”‚  Build  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜          â”‚               â”‚
         â”‚               â”‚               â”‚
         â–¼               â–¼               â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚              Deploy                  â”‚
    â”‚   (staging: develop)                 â”‚
    â”‚   (production: main)                 â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸš€ ä½¿ç”¨æ–¹å¼

### æœ¬åœ°åŸ·è¡Œ CI æª¢æŸ¥

```bash
# åŸ·è¡Œå®Œæ•´é©—è­‰ï¼ˆèˆ‡ CI ç›¸åŒï¼‰
npm run ci

# æˆ–åˆ†æ­¥åŸ·è¡Œ
npm run typecheck      # TypeScript æª¢æŸ¥
npm run lint           # ESLint æª¢æŸ¥
npm run format:check   # æ ¼å¼æª¢æŸ¥
npm run test:ci        # æ¸¬è©¦
```

### TypeScript ç·¨è­¯

```bash
npm run build          # ç·¨è­¯ TypeScript
npm run build:watch    # ç›£è¦–æ¨¡å¼ç·¨è­¯
```

### æŸ¥çœ‹çµ±è¨ˆ

```bash
npm run stats          # æŸ¥çœ‹è¨ˆç®—å™¨çµ±è¨ˆ
```

---

## ðŸ“¦ ç‰ˆæœ¬ç™¼å¸ƒ

### æ–¹æ³• 1: ä½¿ç”¨ Git Tag

```bash
# å»ºç«‹ç‰ˆæœ¬ tag
git tag v1.2.3
git push origin v1.2.3

# é€™æœƒè‡ªå‹•è§¸ç™¼ release.yml å·¥ä½œæµ
```

### æ–¹æ³• 2: æ‰‹å‹•è§¸ç™¼

1. å‰å¾€ GitHub Actions
2. é¸æ“‡ "Release" å·¥ä½œæµ
3. é»žæ“Š "Run workflow"
4. è¼¸å…¥ç‰ˆæœ¬è™Ÿ

---

## ðŸ”§ é…ç½®èªªæ˜Ž

### å¿…è¦çš„ Secrets

åœ¨ GitHub Repository Settings > Secrets ä¸­è¨­å®šï¼š

| Secret åç¨± | èªªæ˜Ž | å¿…è¦æ€§ |
|------------|------|--------|
| `CODECOV_TOKEN` | Codecov è¦†è“‹çŽ‡å ±å‘Š | é¸ç”¨ |
| `DOCKERHUB_USERNAME` | Docker Hub ç”¨æˆ¶å | é¸ç”¨ |
| `DOCKERHUB_TOKEN` | Docker Hub å­˜å–ä»¤ç‰Œ | é¸ç”¨ |

### ç’°å¢ƒè¨­å®š

åœ¨ GitHub Repository Settings > Environments ä¸­è¨­å®šï¼š

- **staging**: é–‹ç™¼/æ¸¬è©¦ç’°å¢ƒ
- **production**: æ­£å¼ç’°å¢ƒï¼ˆå»ºè­°åŠ å…¥å¯©æ ¸è¦æ±‚ï¼‰

---

## ðŸ“Š å·¥ä½œæµèªªæ˜Ž

### 1. ci.yml - ä¸»è¦ Pipeline

**è§¸ç™¼æ¢ä»¶**: Push åˆ° `main`/`develop`ã€PR

| Job | èªªæ˜Ž | é˜»æ“‹éƒ¨ç½² |
|-----|------|---------|
| lint | ESLint æª¢æŸ¥ | âŒ (è­¦å‘Š) |
| typecheck | TypeScript é¡žåž‹æª¢æŸ¥ | âŒ (è­¦å‘Š) |
| test | å–®å…ƒæ¸¬è©¦ | âŒ (èª¿æ•´ä¸­) |
| build | ç·¨è­¯é©—è­‰ | âœ… |
| security | å®‰å…¨æŽƒæ | âŒ (å ±å‘Š) |
| docker | Docker å»ºç½® | âœ… (main only) |
| medical-validation | è¨ˆç®—å™¨é©—è­‰ | âŒ (å ±å‘Š) |

### 2. pr-check.yml - PR æª¢æŸ¥

**è§¸ç™¼æ¢ä»¶**: PR é–‹å•Ÿ/æ›´æ–°

- å¿«é€Ÿ TypeScript å’Œ Lint æª¢æŸ¥
- è®Šæ›´åˆ†æžï¼ˆå“ªäº›å€åŸŸå—å½±éŸ¿ï¼‰
- è‡ªå‹•æ¨™ç±¤

### 3. release.yml - ç‰ˆæœ¬ç™¼å¸ƒ

**è§¸ç™¼æ¢ä»¶**: æŽ¨é€ `v*.*.*` æ¨™ç±¤

- å»ºç½® release package
- å»ºç«‹ Docker æ˜ åƒ
- ç™¼å¸ƒ GitHub Release
- ç”Ÿæˆ changelog

### 4. maintenance.yml - å®šæœŸç¶­è­·

**è§¸ç™¼æ¢ä»¶**: æ¯é€±ä¸€ 10:00 (å°ç£æ™‚é–“)

- ä¾è³´å®‰å…¨å¯©è¨ˆ
- ä»£ç¢¼å¥åº·åº¦å ±å‘Š
- è¨ˆç®—å™¨é©—è­‰
- è‡ªå‹•å»ºç«‹ç¶­è­· Issue

---

## ðŸ·ï¸ è‡ªå‹•æ¨™ç±¤

PR æœƒæ ¹æ“šè®Šæ›´çš„æª”æ¡ˆè‡ªå‹•åŠ ä¸Šæ¨™ç±¤ï¼š

| æ¨™ç±¤ | è§¸ç™¼æ¢ä»¶ |
|------|---------|
| `calculators` | è¨ˆç®—å™¨æª”æ¡ˆè®Šæ›´ |
| `core` | æ ¸å¿ƒæ¨¡çµ„è®Šæ›´ |
| `fhir` | FHIR ç›¸é—œè®Šæ›´ |
| `styles` | CSS æ¨£å¼è®Šæ›´ |
| `tests` | æ¸¬è©¦æª”æ¡ˆè®Šæ›´ |
| `documentation` | æ–‡æª”è®Šæ›´ |
| `ci-cd` | CI/CD é…ç½®è®Šæ›´ |
| `typescript` | TypeScript æª”æ¡ˆè®Šæ›´ |

---

## ðŸ”„ Dependabot

è‡ªå‹•æ¯é€±æª¢æŸ¥ä¾è³´æ›´æ–°ï¼š

- **npm ä¾è³´**: é€±ä¸€æª¢æŸ¥ï¼Œæœ€å¤šé–‹ 5 å€‹ PR
- **GitHub Actions**: é€±ä¸€æª¢æŸ¥
- **Docker**: é€±ä¸€æª¢æŸ¥

---

## ðŸ“ Issue æ¨¡æ¿

- **ðŸ› Bug å›žå ±**: ä¸€èˆ¬ bug å›žå ±
- **âœ¨ åŠŸèƒ½è«‹æ±‚**: æ–°åŠŸèƒ½å»ºè­°
- **ðŸ¥ è¨ˆç®—å™¨å•é¡Œ**: è¨ˆç®—å™¨è¨ˆç®—éŒ¯èª¤/è‡¨åºŠå•é¡Œ

---

## âš ï¸ æ³¨æ„äº‹é …

1. **æ¸¬è©¦ç›®å‰è™•æ–¼èª¿æ•´æœŸ**: ç”±æ–¼æž¶æ§‹é‡æ§‹ï¼Œéƒ¨åˆ†æ¸¬è©¦å¯èƒ½éœ€è¦æ›´æ–°
2. **Lint éŒ¯èª¤æš«ä¸é˜»æ“‹**: è¨­å®šç‚º `continue-on-error: true`
3. **Docker éƒ¨ç½²éœ€è¦è¨­å®š secrets**: å¦å‰‡æœƒè·³éŽ

---

## ðŸ”§ æ•…éšœæŽ’é™¤

### CI å¤±æ•—æ€Žéº¼è¾¦ï¼Ÿ

1. æŸ¥çœ‹å¤±æ•—çš„ job è©³ç´°æ—¥èªŒ
2. æœ¬åœ°åŸ·è¡Œ `npm run ci` é‡ç¾å•é¡Œ
3. æ ¹æ“šéŒ¯èª¤è¨Šæ¯ä¿®å¾©

### TypeScript éŒ¯èª¤

```bash
# æœ¬åœ°æª¢æŸ¥
npm run typecheck

# æŸ¥çœ‹è©³ç´°éŒ¯èª¤
npx tsc --noEmit 2>&1 | head -50
```

### æ¸¬è©¦å¤±æ•—

```bash
# åŸ·è¡Œç‰¹å®šæ¸¬è©¦
npm test -- tests/calculators/qsofa.test.js

# æŸ¥çœ‹è©³ç´°è¼¸å‡º
npm test -- --verbose
```
